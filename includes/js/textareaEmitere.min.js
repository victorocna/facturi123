(function(h){h.fn.extend({textareaEmitere:function(){var g=['paddingTop','paddingRight','paddingBottom','paddingLeft','fontSize','lineHeight','fontFamily','width','fontWeight'];return this.each(function(){if(this.type!='textarea'){return false}var d=h(this),$twin=h('<div />').css({'position':'absolute','display':'none','word-wrap':'break-word'}).addClass('textareaEmitere'),lineHeight=parseInt(d.css('line-height'),10)||parseInt(d.css('font-size'),'10'),minheight=parseInt(d.css('height'),10)||lineHeight*3,maxheight=parseInt(d.css('max-height'),10)||Number.MAX_VALUE,goalheight=0,i=0;if(maxheight<0){maxheight=Number.MAX_VALUE}$twin.appendTo(d.parent());var f=d.parent().find('div').length;if(f>1){for(j=0;j<f;j++){d.parent().find('div').eq(j).remove()}}var i=g.length;while(i--){$twin.css(g[i].toString(),d.css(g[i].toString()))}function setHeightAndOverflow(a,b){curratedHeight=Math.floor(parseInt(a,10));if(d.height()!=curratedHeight){d.css({'height':curratedHeight+'px','overflow':b})}}function update(){var a=d.val().replace(/&/g,'&amp;').replace(/  /g,'&nbsp;').replace(/<|>/g,'&gt;').replace(/\n/g,'<br />');var b=$twin.html();if(a+'&nbsp;'!=b){$twin.html(a+'&nbsp;');if(Math.abs($twin.height()+lineHeight-d.height())>3){var c=$twin.height()+lineHeight;if(c>=maxheight){setHeightAndOverflow(maxheight,'auto')}else if(c<=minheight){setHeightAndOverflow(minheight,'hidden')}else{setHeightAndOverflow($twin.height(),'hidden')}}}}d.css({'overflow':'hidden'});d.keyup(function(){update()});d.live('input paste',function(e){setTimeout(update,250)});update()})}})})(jQuery);